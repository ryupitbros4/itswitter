<div class="container">
  <% restaurants.each do |restaurant| %>
    <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
      <section class="card">

	<!-- store title -->
	<article class="card-content-row-1">
	  <%= link_to restaurant.name, shop_info_path(:shop_name => restaurant.name, :shop_id => restaurant.id) %>
        </article>

	<!-- state & comment & commenter -->
        <article class="card-content-row-2">
	  <div class="state-part col-xs-4 col-sm-4 col-md-4 col-lg-4">
	    <div class="state-icon">
	      <%= image_tag(crowded_image[restaurant.crowdedness], :size => "40x40") %>
	    </div>
	    <div class="state-caption">
	      <p><%= how_crowded[restaurant.crowdedness] %></p>
	    </div>
	  </div>

	  <div class="user-comment col-xs-8 col-sm-8 col-md-8 col-lg-8">
	    <% no_comment = 'まだコメントがありません。' %>
	    <% last_comment = no_comment %>
	    <% non_reporter = '報告者がいません' %>
	    <% reporter = non_reporter %>

	    <% if restaurant.latest_comment.present? %>
	      <% reporter = restaurant.latest_comment.user.nickname %>
	      <% if restaurant.latest_comment.comment.present? %>
	        <% last_comment = restaurant.latest_comment.comment %>
	      <% else %>
	        <% last_comment = '最新コメントなし' %>
	      <% end %>
	    <% end %>
	    
	    <div class="commenter-part">
	      <% if reporter != non_reporter %>
	        <%= image_tag(User.find(restaurant.latest_comment.user_id).image_url, size: "19x19") %>
		<%= link_to reporter, my_index_path(u_id: restaurant.latest_comment.user_id )%>
	      <% else %>
	        <p><%= reporter %></p>
	      <% end %>
            </div>
	    <div class="comment-part">
	      <% if last_comment != no_comment %>
	        <%= link_to last_comment.truncate(16), { :controller => "restaurants", :action => "comment_log", :restaurant_id => restaurant.id } %>
	      <% else %>
	        <p><%= last_comment %></p>
	      <% end %>
	    </div>
	  </div>

	</article>

	<!-- watch & tell & good! buttons -->
	<article class="card-content-row-3">
	  <% login_check = logged_in? %>
	  <%= login_check %>
	  <div class="watch-part col-xs-4 col-sm-4 col-md-4 col-lg-4">
	    <p>お店を</p>
	    <% if login_check %>
	      <% if current_user.restaurants.include? restaurant # follow yes %>
	        <!-- watchフラグを下ろす  --> 
	        <button type="button" class="btn btn-default btn-xs">unwatch</button>
	      <% else # follow no %>
	        <!-- watchフラグを上げる-->
	        <button type="button" class="btn btn-default btn-xs">watch</button>
	      <% end %>
	    <% else %>
	      <button type="button" class="btn btn-default btn-xs" disabled="disabled">watch</button>
	    <% end %>
	  </div>
	  <div class="tell-part col-xs-4 col-sm-4 col-md-4 col-lg-4">
	    <p>状況を</p>
	    <% if login_check %>
	      <!-- ここにリンク -->
	      <button type="button" class="btn btn-default btn-xs">伝える</button>
	    <% else %>
	      <button type="button" class="btn btn-default btn-xs" disabled="disabled">伝える</button>
	    <% end %>
	  </div>
	  <div class="good-part col-xs-4 col-sm-4 col-md-4 col-lg-4">
	    <p>コメントを</p>
	    <% if login_check %>
	    <!-- ここに分岐 -->
	      <button type="button" class="btn btn-default btn-xs">いいね！</button>
	    <% else %>
	      <button type="button" class="btn btn-default btn-xs" disabled="disabled">いいね！</button>
	    <% end %>
	  </div>

	</article>

      </section>
    </div>
  <% end %>
</div>
