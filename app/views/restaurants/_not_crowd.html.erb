
<div class="contents">
  <div class="container"><h2 style="color: black;">フォロー店の最新コメント</h2>
<!--
    <table class="table table-hover">
      <thead>
    	<tr>
	  <th class="col-md-3">混雑度</th>
          <th class="col-md-5">店名</th>
	  <th class="col-md-4">最新更新時</th>
    	</tr>
        <tr>
          <th colspan="3" class="col-md-12">コメント</th>
        </tr>
      </thead>
    </table>
-->
  <% rank.each do |ranking| %>
    <% latest_comment = ranking.latest_comment %>     
    <% if latest_comment.blank? %>
      <% latest_comment = 'コメント無し' %>
    <% end %>
    <table class="table table-hover table-bordered">
      <tbody>
        <tr>
	  <td class="col-md-3 success"><%= image_tag(crowded_image[ranking.crowdedness], :size => "32x32") %>&nbsp;&nbsp;<%= link_to how_crowded[ranking.crowdedness], :controller => "restaurants", :action => "report", :resname => ranking.id %></td>
          <td class="col-md-5 success"><%= link_to ranking.name, "https://www.google.co.jp/search?q=" + ranking.name %></td>
          <td class="col-md-4 success"><%= sec2h((Time.zone.now - ranking.updated_at).to_i) %>前</td>
        </tr>
        <tr>
          <% if logged_in? %>
	    <td colspan="2" class="col-md-10" style="word-wrap:break-word;" bgcolor="#FFFFFF"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span>&nbsp;&nbsp;<%= link_to latest_comment.truncate(23), :controller => "restaurants", :action => "comment_log", :restaurant_id => ranking.id %>
	    
	      <% if (!(ranking.comment_user_id.blank?) && !(session[:user_id].blank?) && (ranking.comment_user_id != session[:user_id]))  %>
	    
                <% if (PressedUser.find_by(comment_id: ranking.latest_comment_id, user_id: session[:user_id]).blank?) %>
                  <%= button_to "いいね!", {:controller => "restaurants", :action => "add_like_point", :user_id => ranking.comment_user_id, :comment_id => ranking.latest_comment_id} %><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
                <% else %>
                  <br><%= button_to "いいね!取り消し", {:controller => "restaurants", :action => "cancel_like", :user_id => ranking.comment_user_id, :comment_id => ranking.latest_comment_id} %>
                <% end %>
                報告者:<%= User.find(ranking.comment_user_id).nickname %>さん
              <% end %>
	    </td>
            <td class="col-md-2" bgcolor="#FFFFFF">
              <% if current_user.restaurants.include? ranking %>
                <span class="glyphicon glyphicon-star" id="follow-unfollow-area-<%= ranking.id %>"><%= link_to 'フォロー解除', unfollow_restaurant_path(ranking), { method: :post, remote: true }%>
              <% else %>
                <span class="glyphicon glyphicon-star-empty" id="follow-unfollow-area-<%= ranking.id %>"><%= link_to 'フォローする', follow_restaurant_path(ranking), { method: :post, remote: true }  %>
              <% end %>
            </td>
          <% else %>
	    <td colspan="3" class="col-md-10" style="word-wrap:break-word;" bgcolor="#FFFFFF"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span>&nbsp;&nbsp;<%= link_to latest_comment.truncate(23), :action => "comment_log", :restaurant_id => ranking.id %>

	    <% if (!(ranking.comment_user_id.blank?) && !(session[:user_id].blank?) && (ranking.comment_user_id != session[:user_id]))  %>
	    
              <% if (PressedUser.find_by(comment_id: ranking.latest_comment_id, user_id: session[:user_id]).blank?) %>
                <%= button_to "いいね!", {:action => "add_like_point", :user_id => ranking.comment_user_id, :comment_id => ranking.latest_comment_id} %><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
              <% else %>
                <br><%= button_to "いいね!取り消し", {:action => "cancel_like", :user_id => ranking.comment_user_id, :comment_id => ranking.latest_comment_id} %>
              <% end %>
              報告者:<%= User.find(ranking.comment_user_id).nickname %>さん
            <% end %>
	    </td>
          <% end %>
	</tr>
      </tbody>
    </table>
  <% end %>
  </div>
</div>
